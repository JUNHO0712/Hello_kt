# =================================================================
# Chrony 설정 파일 (AWS EC2 최적화 버전)
# =================================================================

# 1. 시간 동기화 서버 지정 (AWS Time Sync Service)
# 설명: AWS 내부망에 있는 타임 서버를 최우선(prefer)으로 사용합니다.
#      외부 인터넷을 타지 않아 보안상 안전하고 오차가 거의 없습니다.
server 169.254.169.123 prefer iburst minpoll 4 maxpoll 4

# 설명: 만약 AWS 타임 서버가 죽을 경우를 대비한 백업용 공용 서버들입니다.
pool 2.ubuntu.pool.ntp.org iburst

# 2. 초기 동기화 속도 설정
# 설명: 시스템 시작 시, 시간 오차가 크더라도 즉시 동기화하도록 설정합니다.
makestep 1.0 3

# 3. 하드웨어 시계(RTC) 동기화
# 설명: 커널의 시스템 시간을 하드웨어 시계에도 주기적으로 기록합니다.
rtcsync

# 4. 접근 제어 (보안)
# 설명: 외부에서 이 서버의 시간을 조회하지 못하도록 막습니다. (내부용이므로)
#      cmdallow는 로컬호스트(127.0.0.1)에서만 명령어를 내릴 수 있게 합니다.
allow 127.0.0.1
deny all

# 5. 오차 기록 파일 경로
# 설명: 시간 오차가 얼마나 발생하는지 기록하여 나중에 분석할 수 있게 합니다.
driftfile /var/lib/chrony/chrony.drift

# 6. 로그 설정
# 설명: 시간 동기화 관련 로그를 저장할 경로를 지정합니다.
logdir /var/log/chrony

# 7. 윤초(Leap Second) 처리
# 설명: 지구가 자전하는 속도 차이로 발생하는 1초(윤초)를 부드럽게 처리합니다.
leapsectz right/UTC
