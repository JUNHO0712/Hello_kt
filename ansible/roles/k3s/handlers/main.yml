---
# 1. 커널 파라미터 적용 핸들러
# 설명: sysctl 설정 파일이 변경되었을 때 커널에 즉시 반영합니다.
- name: Reload sysctl
  command: sysctl --system
  become: true

# 2. K3s 서비스 관리 핸들러
# 설명: K3s 설정 파일이나 바이너리 변경 시 서비스를 재시작합니다.
- name: Restart k3s service
  systemd:
    name: k3s
    state: restarted
    daemon_reload: yes
  become: true

# 3. K3s 설정 리로드 핸들러
# 설명: 서비스 중단 없이 설정을 다시 읽어옵니다.
- name: Reload k3s configuration
  systemd:
    name: k3s
    state: reloaded
  become: true

# 4. 서비스 상태 검증 핸들러
# 설명: 재시작 후 서비스가 정상적으로 동작하는지 로그를 확인합니다.
- name: Check k3s service status
  command: systemctl status k3s
  register: k3s_status
  changed_when: false
  become: true

# Sysctl 설정 시: sysctl 태스크 끝에 notify: Reload sysctl을 추가하세요.
# 설정 파일 변경 시: K3s 설정 파일을 배포하는 태스크 끝에 notify: Restart k3s service를 추가하세요.